<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cf.dao.mapper.CfUserMapper" >
  <resultMap id="CfUserMap" type="com.cf.cfsecurity.dao.model.CfUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 27 15:36:25 CST 2013.
    -->
    <id column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="USER_NAME" property="name" jdbcType="VARCHAR" />
    <result column="PASSWD" property="passwd" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR" />
    <result column="BRANCH_NO" property="branchNo" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="LAST_IP" property="lastIp" jdbcType="VARCHAR" />
    <result column="LAST_TIME" property="lastDate" jdbcType="TIMESTAMP" />
    <result column="WRONG_PWD_COUNT" property="wrongPwdCount" jdbcType="DECIMAL" />
    <result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="accountNonExpired" property="accountnonexpired" jdbcType="VARCHAR" />
    <result column="accountNonLocked" property="accountnonlocked" jdbcType="VARCHAR" />
    <result column="credentialsNonExpired" property="credentialsnonexpired" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectUsersByName" resultMap="CfUserMap" parameterType="java.lang.String"> 
  	select a.* from TB_USER a
  	<where> 
  		1=1 
  		<if test="USERNAME!=null"> 
  			AND a.USER_ID = #{USERNAME} 
  		</if> 
  	</where> 
  </select>
  
  <update id="LoginForUpdate" parameterType="java.util.HashMap"> 
  	UPDATE TB_USER set LAST_IP = #{LAST_IP,jdbcType=VARCHAR},
  	LAST_DATE = #{LAST_DATE,jdbcType=TIMESTAMP}	 
  	<where> 
  		1=1 and USER_ID= #{USER_NAME,jdbcType=VARCHAR}
  	</where> 
  </update>
  
  <insert id="LoginForAudit" parameterType="java.util.HashMap"> 
  	insert into TB_LOGIN_AUDITS (ID,IP,SESSION_ID,AUDIT_TYPE,MESSAGE,USER_ID,CREATE_TIME,SOURCE_TYPE)
  	values(#{ID,jdbcType=VARCHAR},
  			#{LAST_IP,jdbcType=VARCHAR},
  			#{SESSION_ID,jdbcType=VARCHAR},
  			#{AUDIT_TYPE,jdbcType=VARCHAR},
  			#{MESSAGE,jdbcType=VARCHAR},
  			#{USER_NAME,jdbcType=VARCHAR},
  			#{CREATE_TIME,jdbcType=VARCHAR},
  			#{SOURCE_TYPE,jdbcType=VARCHAR})
  </insert>
  
  <select id="selectUsers" resultType="java.util.HashMap" > 
  	select a.* from TB_USER a
  	<where> 
  		1=1 
  	</where> 
  </select>
  
   <!--查询当前用户的所有按钮权限 -->
  <select id="selectBtnByUser" parameterType="java.lang.String" resultType="java.util.HashMap">
		SELECT DISTINCT 
			a.BUTTON_ID,
			a.PARENT_ID 
		FROM TB_RESOURCE a
		inner join TB_ROLE_RESOURCE b on a.res_id=b.res_id
		inner join TB_USER_ROLE c on b.role_id=c.role_id
		<where> 
			c.USER_ID=#{USER_ID,jdbcType=VARCHAR} and a.IS_BUTTON = '1'
		</where> 
  </select> 
  
</mapper>